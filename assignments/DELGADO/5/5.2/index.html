<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 5.2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    </head>
    <body>
        <h1>My Favorite Items</h1>
        <p id="food">Food: </p>
        <p id="game">Game: </p>
        <p id="animal">Animal: </p>
        <p id="show">Show: </p>

        <button class="btn btn-danger" onClick=failButton()>Fail</button>
        <button class="btn btn-success" onClick=succeedButton()>Succeed</button>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    </body>
<script>
    const foodEle = document.getElementById("food");
    const gameEle = document.getElementById("game");
    const animalEle = document.getElementById("animal");
    const showEle = document.getElementById("show");
    
    function failButton() {
        const serverUrl = 'http://localhost:3000/fail';
        fetch(serverUrl)
        .then(response => {
            // Check if the response was successful
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            getResponse(response);
            return response.json();
        })
        .then(data => {
            console.log(data);
        })
        .catch(error => {
            console.error('CORS', error);
        });
    }

    function succeedButton() {
        const serverUrl = 'http://localhost:3000/succeed';

        fetch(serverUrl)
        .then(response => {
            // Check if the response was successful
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            getResponse(response);
            return response.json();
        })
        .then(data => {
            // This runs only AFTER the CORS block is resolved
            console.log(data);
        })
        .catch(error => {
            // This is where the initial CORS error will show up in the browser console
            console.error('CORS', error);
        });
    }

    function getResponse(response) {
        if(response.headers.get('X-CS533f25-FOOD')) {
            foodEle.innerHTML = "Food: " + response.headers.get('X-CS533f25-FOOD');
        } else {
            foodEle.innerHTML = "Food: ";
        }

        if(response.headers.get('X-CS533f25-GAME')) {
            gameEle.innerHTML = "Game: " + response.headers.get('X-CS533f25-GAME');
        } else {
            gameEle.innerHTML = "Game: ";
        }

        if(response.headers.get('X-CS533f25-ANIMAL')) {
            animalEle.innerHTML = "Animal: " + response.headers.get('X-CS533f25-ANIMAL');
        } else {
            animalEle.innerHTML = "Animal:";
        }

        if(response.headers.get('X-CS533f25-SHOW')) {
            showEle.innerHTML = "Show: " + response.headers.get('X-CS533f25-SHOW')
        } else {
            showEle.innerHTML = "Show:";
        }
    }
    
</script>

</html>